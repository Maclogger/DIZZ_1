@using Microsoft.JSInterop
@inject IJSRuntime JsRuntime

<div class="overflow-hidden" style="width: 800px; height: 500px">
    <canvas id="@_canvasId" width="800" height="400"></canvas>
</div>

@code {
    [Parameter]
    public string Title { get; set; } = "Line Chart";

    [Parameter]
    public string XAxisLabel { get; set; } = "X Axis";

    [Parameter]
    public string YAxisLabel { get; set; } = "Y Axis";

    private string _canvasId = $"chart-{Guid.NewGuid()}";

    private IJSObjectReference? _module;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _module = await JsRuntime.InvokeAsync<IJSObjectReference>(
                "import", "./js/realTimeChart.js");

            await _module.InvokeVoidAsync("initializeChart", _canvasId,
                new ChartConfiguration
                {
                    Title = Title,
                    XAxisLabel = XAxisLabel,
                    YAxisLabel = YAxisLabel
                });
        }
    }

    public async Task AddValue(double value)
    {
        if (_module is not null)
        {
            await _module.InvokeVoidAsync("addDataPoint", _canvasId, value);
        }
    }

    public class ChartConfiguration
    {
        public string Title { get; set; } = "";
        public string XAxisLabel { get; set; } = "";
        public string YAxisLabel { get; set; } = "";
    }
}
